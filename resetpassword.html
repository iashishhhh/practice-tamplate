<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Password Reset</title>
</head>

<body>
    <section class="p-3 vh-100 d-flex justify-content-center align-items-center">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12 col-md-9 col-lg-7 col-xl-6 col-xxl-5">
                    <div class="card border-0 shadow-lg rounded-4">
                        <div class="card-body p-3 p-md-4 p-xl-5">
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-5">
                                        <h2 class="h3">Password Reset</h2>
                                        <h3 class="fs-6 fw-normal text-secondary m-0">
                                            Provide the email address associated with your account to recover your
                                            password.
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <form id="passwordResetForm">
                                <div class="row gy-3 overflow-hidden">
                                    <div class="col-12">
                                        <div class="form mb-3">
                                            <label for="email" class="form-label">Email</label>
                                            <input type="email" class="form-control" name="email" id="email"
                                                placeholder="name@example.com">
                                        </div>
                                        <div class="form mb-3">
                                            <label for="password" class="form-label">New Password</label>
                                            <input type="password" class="form-control" name="password" id="password"
                                                placeholder="">
                                        </div>
                                        <div class="form mb-3">
                                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                                            <input type="password" class="form-control" name="confirmPassword"
                                                id="confirmPassword" placeholder="">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="d-grid">
                                        <button class="btn bsb-btn-2xl btn-primary" type="submit">Reset
                                            Password</button>
                                    </div>
                                </div>
                            </form>
                            <div class="row">
                                <div class="col-12 px-3 pb-2 text">
                                    <hr class="mt-5 mb-4 border-secondary-subtle">
                                    <div class="d-flex gap-2 gap-md-4 flex-column flex-md-row justify-content-md-end">
                                        <a href="login.html" class="link-secondary text-decoration-none">Login</a>
                                        <a href="singup.html" class="link-secondary text-decoration-none">signup</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="passwordError" class="error"></div>
    <script>
        // Capture form submit event
        document.getElementById('passwordResetForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent form from refreshing the page

            // Clear previous errors
            clearErrors();

            // Collect form values
            const email = document.getElementById('email').value.trim();
            const newPassword = document.getElementById('password').value.trim();
            const confirmNewPassword = document.getElementById('confirmPassword').value.trim();

            let isValid = true;

            // Custom validation
            if (email === '') {
                showError('emailError', 'Email is required!');
                isValid = false;
            } else if (!validateEmail(email)) {
                showError('emailError', 'Please enter a valid email address.');
                isValid = false;
            }

            if (newPassword === '') {
                showError('passwordError', 'New password is required!');
                isValid = false;
            } else if (!validatePassword(newPassword)) {
                showError('passwordError', 'Password must be at least 8 characters long and contain a mix of uppercase, lowercase, digits, and special characters.');
                isValid = false;
            }

            if (confirmNewPassword === '') {
                showError('confirmPasswordError', 'Please confirm your new password!');
                isValid = false;
            } else if (newPassword !== confirmNewPassword) {
                showError('confirmPasswordError', 'Passwords do not match!');
                isValid = false;
            }

            if (isValid) {
                // Retrieve user data from localStorage
                const storedUserData = JSON.parse(localStorage.getItem('userData'));

                if (storedUserData && storedUserData.email === email) {
                    // If email matches, update the password
                    storedUserData.password = newPassword;

                    // Save the updated data back to localStorage
                    localStorage.setItem('userData', JSON.stringify(storedUserData));

                    alert('Password successfully updated!');
                    console.log('Updated User Data:', storedUserData);
                    document.getElementById('passwordResetForm').reset();
                } else {
                    showError('emailError', 'Email not found!');
                }
            }
        });

        // Helper function to validate email
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Helper function to validate password (custom validation)
        function validatePassword(password) {
            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
            return passwordRegex.test(password);
        }

        // Helper function to show errors
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.innerText = message;
            }
        }

        // Helper function to clear errors
        function clearErrors() {
            const errorElements = document.querySelectorAll('.error');
            errorElements.forEach(element => {
                element.innerText = '';
            });
        }
    </script>
</body>

</html>